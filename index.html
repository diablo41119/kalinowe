<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Turniej Kalinowe Pole ‚Äì LiveScore (Pary)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
--bg:#0b1020;--card:#121933;--muted:#9bb0d6;--accent:#9fd25b;--text:#eef3ff;
--eagle:#8b5cf6; /* fiolet */
--birdie:#38bdf8; /* jasny niebieski */
--par:#22c55e; /* zielony */
--bogey1:#facc15; /* ≈º√≥≈Çty */
--bogey2:#f97316; /* pomara≈Ñczowy */
--bogey3:#ef4444; /* czerwony */
}
body.light{
--bg:#f2f4ff;--card:#ffffff;--muted:#5b678a;--accent:#0077ff;--text:#0a0a0a;
}
*{box-sizing:border-box;font-family:'Inter',sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}
header{position:sticky;top:0;z-index:50;background:rgba(11,16,32,.95);backdrop-filter:blur(8px);
border-bottom:1px solid #22305e;display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:10px}
h1{font-size:18px;margin:0 10px 0 0;font-weight:800}
button{cursor:pointer;border:none;border-radius:10px;padding:8px 12px;font-weight:700}
.btn{background:var(--accent);color:#0a0a0a}
.secondary{background:var(--card);color:var(--text);border:1px solid #2a3a72}
input[type=text]{padding:8px 10px;border-radius:10px;border:1px solid #2a3a72;background:#0e1430;color:var(--text)}
main{padding:10px;max-width:1200px;margin:0 auto}
.section-title{margin:14px 4px 6px;font-weight:900;color:var(--accent);font-size:18px}
.grid{border-radius:12px;border:1px solid #2a3a72;background:var(--card);overflow:hidden}
table{width:100%;border-collapse:collapse;min-width:760px}
th,td{padding:6px;border-bottom:1px dashed #243468;text-align:center}
th:first-child,td:first-child{text-align:left;padding-left:10px}
input[type=number]{width:70px;text-align:center;padding:6px;border-radius:8px;border:1px solid #2a3a72;background:#0e1430;color:var(--text)}
.score.eagle{background:var(--eagle);color:#fff}
.score.birdie{background:var(--birdie);color:#000}
.score.par{background:var(--par);color:#fff}
.score.bogey1{background:var(--bogey1);color:#000}
.score.bogey2{background:var(--bogey2);color:#fff}
.score.bogey3{background:var(--bogey3);color:#fff}
.leaderboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px}
.card{background:var(--card);border:1px solid #2a3a72;border-radius:12px;padding:10px}
.flex-between{display:flex;justify-content:space-between;align-items:center;gap:8px}
.badge{padding:3px 7px;border-radius:999px;background:#213169;font-size:13px;display:inline-block}
.good{background:rgba(74,210,115,0.15);border:1px solid #4ad273}
.bad{background:rgba(255,107,107,0.15);border:1px solid #ff6b6b}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:10px;margin-top:15px}
.stats-card{background:var(--card);border:1px solid #2a3a72;border-radius:10px;padding:8px 12px}
.footer{text-align:center;font-size:12px;color:var(--muted);margin-top:10px}
</style>
</head>
<body>
<header>
<h1>Turniej Kalinowe Pole ‚Äì LiveScore (Pary)</h1>
<button id="toggleTheme" class="secondary">üåô/‚òÄÔ∏è</button>
<div style="margin-left:auto;display:flex;gap:6px">
<input id="gameId" placeholder="ID gry" value="kalinowe"/>
<button id="joinBtn" class="btn">Do≈ÇƒÖcz</button>
</div>
</header>

<main>
<div class="section-title">Indywidualny leaderboard</div>
<section id="leaderboard" class="leaderboard"></section>

<div class="section-title">Leaderboard par (Best Ball)</div>
<section id="teamboard" class="leaderboard"></section>

<div class="section-title">Tabela wynik√≥w</div>
<div class="grid">
<table><thead id="thead"></thead><tbody id="tbody"></tbody><tfoot id="tfoot"></tfoot></table>
</div>

<div class="section-title">Statystyki rundy</div>
<section id="stats" class="stats-grid"></section>

<p class="footer">Live Firestore ‚Ä¢ Best Ball ‚Ä¢ Kalinowe Pole</p>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const app = initializeApp({
apiKey:"AIzaSyDSd57ttRgz_kpaVKurxg7dSXnTSrjQF54",
authDomain:"kalinowe-pola.firebaseapp.com",
projectId:"kalinowe-pola"
});
const db=getFirestore(app);

const PLAYERS=["Oliwia","Karolina","Jƒôdrek","Miko≈Çaj","Krystian","Kosma"];
const TEAMS={
jk:{name:"Jƒôdrek + Kosma",players:["Jƒôdrek","Kosma"],hcp:30},
km:{name:"Krystian + Miko≈Çaj",players:["Krystian","Miko≈Çaj"],hcp:24},
ko:{name:"Karolina + Oliwia",players:["Karolina","Oliwia"],hcp:38}
};
const HOLES=18;
let state={}, gameId="kalinowe";

const thead=document.getElementById("thead"),
tbody=document.getElementById("tbody"),
tfoot=document.getElementById("tfoot"),
leaderboard=document.getElementById("leaderboard"),
teamboard=document.getElementById("teamboard"),
stats=document.getElementById("stats");

document.getElementById("toggleTheme").onclick=()=>document.body.classList.toggle("light");
document.getElementById("joinBtn").onclick=async()=>{
gameId=document.getElementById("gameId").value||"kalinowe";
const ref=doc(db,"games",gameId);
const s=await getDoc(ref);
if(!s.exists()){
const par={},scores={};
for(let h=1;h<=HOLES;h++)par["h"+h]=4;
for(const p of PLAYERS){scores[p]={};for(let h=1;h<=HOLES;h++)scores[p]["h"+h]=null;}
await setDoc(ref,{par,scores,teams:TEAMS});
}
onSnapshot(ref,snap=>{state=snap.data();renderAll();});
};

function updateField(path,val){
const ref=doc(db,"games",gameId);
const payload={};payload[path]=val;updateDoc(ref,payload);
}

function signed(n){return n>0?`+${n}`:`${n}`;}
function sumPar(par){return Array.from({length:HOLES},(_,i)=>par["h"+(i+1)]??4).reduce((a,b)=>a+Number(b),0);}

function playerTotal(p,par,scores){
let s=0,d=0,has=false;
for(let h=1;h<=HOLES;h++){const sc=scores[p]?.["h"+h];const pa=par["h"+h]??4;
if(sc!=null){s+=+sc;d+=(+sc-pa);has=true;}}
return {s:has?s:null,delta:has?d:0};
}

function bestBall(team,par,scores){
let gross=0,has=false;
for(let h=1;h<=HOLES;h++){
const a=scores[team.players[0]]?.["h"+h],b=scores[team.players[1]]?.["h"+h];
let best=null;if(a!=null&&b!=null)best=Math.min(+a,+b);else if(a!=null)best=+a;else if(b!=null)best=+b;
if(best!=null){gross+=best;has=true;}
}
const pars=sumPar(par);const net=has?gross-(team.hcp||0):null;const delta=has?gross-pars:0;
return {gross:has?gross:null,net,delta};
}

function colorClass(diff){
if(diff<=-2)return"eagle";
if(diff==-1)return"birdie";
if(diff==0)return"par";
if(diff==1)return"bogey1";
if(diff==2)return"bogey2";
if(diff>=3)return"bogey3";
return"";
}

function renderTable(par,scores){
thead.innerHTML=`<tr><th>Do≈Çek</th><th>PAR</th>${PLAYERS.map(p=>`<th>${p}</th>`).join("")}<th>¬± do PAR</th></tr>`;
tbody.innerHTML="";
for(let h=1;h<=HOLES;h++){
const parVal=par["h"+h]??4;
let row=`<td>H${h}</td><td><input class="par" data-hole="${h}" type="number" min="3" max="6" value="${parVal}"></td>`;
for(const p of PLAYERS){
const v=scores[p]?.["h"+h];
const diff=v!=null?v-parVal:null;
const cls=colorClass(diff);
row+=`<td><input class="score ${cls}" data-player="${p}" data-hole="${h}" type="number" value="${v??""}" min="1" max="20"></td>`;
}
const txt=PLAYERS.map(n=>{
const sc=scores[n]?.["h"+h];if(sc==null)return null;
const d=sc-(par["h"+h]??4);return ${n}:${signed(d)};
}).filter(Boolean).join(" ‚Ä¢ ");
row+=`<td><span class="badge">${txt||"‚Äî"}</span></td>`;
const tr=document.createElement("tr");tr.innerHTML=row;tbody.append(tr);
}
tfoot.innerHTML="";
const trf=document.createElement("tr");const pars=sumPar(par);
trf.innerHTML=`<th>SUMA</th><th>${pars}</th>`+
PLAYERS.map(p=>{
const t=playerTotal(p,par,scores);
return <th><span class="badge ${t.delta<0?"good":t.delta>0?"bad":""}">${t.s??"-"} (${signed(t.delta)})</span></th>;
}).join("")+`<th></th>`;
tfoot.append(trf);
tbody.querySelectorAll("input.par").forEach(i=>i.onchange=()=>updateField(par.h${i.dataset.hole},+i.value));
tbody.querySelectorAll("input.score").forEach(i=>i.onchange=()=>{
updateField(scores.${i.dataset.player}.h${i.dataset.hole},i.value===""?null:+i.value);
});
}

function renderLeaders(par,scores){
leaderboard.innerHTML="";
const pars=sumPar(par);
const arr=PLAYERS.map(p=>({name:p,...playerTotal(p,par,scores)})).filter(x=>x.s!=null).sort((a,b)=>a.delta-b.delta);
arr.forEach((it,i)=>{
const c=document.createElement("div");c.className="card";
c.innerHTML=`<div class="flex-between"><h3>${i+1}. ${it.name}</h3>
<span class="badge ${it.delta<0?"good":it.delta>0?"bad":""}">${it.s} (${signed(it.delta)})</span></div>
<div class="tiny muted">Par pola: ${pars}</div>`;
leaderboard.append(c);
});
}

function renderTeams(par,scores){
teamboard.innerHTML="";
const pars=sumPar(par);
Object.entries(TEAMS).map(([id,t])=>({...t,...bestBall(t,par,scores)}))
.sort((a,b)=>(a.net??1e9)-(b.net??1e9))
.forEach((it,i)=>{
const c=document.createElement("div");c.className="card";
const grossStr=it.gross!=null?`${it.gross} (${signed(it.delta)})`:"-";
const netStr=it.net!=null?`${it.net}`:"-";
c.innerHTML=`<div class="flex-between"><h3>${i+1}. ${it.name}</h3>
<div><span class="badge ${it.delta<0?"good":it.delta>0?"bad":""}">BRUTTO: ${grossStr}</span>
<span class="badge">NETTO: ${netStr}</span></div></div>
<div class="tiny muted">HCP: ${it.hcp}</div>`;
teamboard.append(c);
});
}

function renderStats(par,scores){
stats.innerHTML="";
PLAYERS.forEach(p=>{
let bird=0,eagle=0,parsC=0,bog1=0,bog2=0,bog3=0,total=0,count=0;
for(let h=1;h<=HOLES;h++){
const sc=scores[p]?.["h"+h];const pa=par["h"+h]??4;if(sc!=null){count++;total+=sc;
const diff=sc-pa;
if(diff<=-2)eagle++;else if(diff==-1)bird++;else if(diff==0)parsC++;
else if(diff==1)bog1++;else if(diff==2)bog2++;else if(diff>=3)bog3++;
}
}
if(count===0)return;
const avg=(total/count).toFixed(1);
const card=document.createElement("div");card.className="stats-card";
card.innerHTML=`<b>${p}</b><br>
≈öredni wynik: ${avg}<br>
Eagle: ${eagle}, Birdie: ${bird}, Par: ${parsC}<br>
+1: ${bog1}, +2: ${bog2}, +3+: ${bog3}`;
stats.append(card);
});
}

function renderAll(){
const par=state.par||{},scores=state.scores||{};
renderTable(par,scores);
renderLeaders(par,scores);
renderTeams(par,scores);
renderStats(par,scores);
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Turniej Kalinowe Pole ‚Äì LiveScore (Pary)</title>
<style>
:root{--bg:#0b1020;--card:#121933;--muted:#9bb0d6;--accent:#9fd25b;--text:#eef3ff;--danger:#ff7070;--ok:#7be495;}
body.light{--bg:#f2f4ff;--card:#ffffff;--muted:#5b678a;--accent:#0077ff;--text:#0a0a0a;--danger:#d94a4a;--ok:#15803d;}
*{box-sizing:border-box;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial}
body{margin:0;background:var(--bg);color:var(--text)}
header{position:sticky;top:0;z-index:50;background:rgba(11,16,32,.95);backdrop-filter:blur(8px);
border-bottom:1px solid #22305e;display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:10px}
body.light header{background:rgba(255,255,255,.95);border-bottom:1px solid #ccc}
h1{font-size:18px;margin:0 10px 0 0;font-weight:800}
button{cursor:pointer;border:none;border-radius:10px;padding:8px 12px;font-weight:700}
.btn{background:var(--accent);color:#0a0a0a}
.secondary{background:var(--card);color:var(--text);border:1px solid #2a3a72}
input[type=text]{padding:8px 10px;border-radius:10px;border:1px solid #2a3a72;background:#0e1430;color:var(--text)}
main{padding:10px;max-width:1200px;margin:0 auto}
.section-title{margin:14px 4px 6px;font-weight:900;color:var(--accent);font-size:18px}
.grid{overflow:auto;border-radius:12px;border:1px solid #2a3a72;background:var(--card)}
table{width:100%;border-collapse:collapse;min-width:760px}
th,td{padding:6px;border-bottom:1px dashed #243468;text-align:center}

/* poprawiony sticky nag≈Ç√≥wek */
thead th{
position: sticky;
top: var(--stickyOffset, 140px);
background: var(--card);
z-index: 10;
}

th:first-child,td:first-child{text-align:left;padding-left:10px}
input[type=number]{width:70px;text-align:center;padding:6px;border-radius:8px;border:1px solid #2a3a72;background:#0e1430;color:var(--text)}
body.light input[type=number]{background:#fff;color:#000;border:1px solid #ccc}
.leaderboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px}
.card{background:var(--card);border:1px solid #2a3a72;border-radius:12px;padding:10px}
.flex-between{display:flex;justify-content:space-between;align-items:center;gap:8px}
.badge{padding:3px 7px;border-radius:999px;background:#213169;font-size:13px;display:inline-block}
.good{background:rgba(74,210,115,0.15);border:1px solid #4ad273}
.bad{background:rgba(255,107,107,0.15);border:1px solid #ff6b6b}
.footer{text-align:center;font-size:12px;color:var(--muted);margin-top:10px}
.spinner{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,.6);color:#fff;font-size:18px;z-index:200}
.hidden{display:none}
.toggle-bar{margin-left:auto;display:flex;gap:6px;align-items:center}
@media(max-width:480px){thead th{top:var(--stickyOffset,150px)}input[type=number]{width:66px}}
</style>
</head>
<body>
<header>
<h1>Turniej Kalinowe Pole ‚Äì LiveScore (Pary)</h1>
<button id="toggleTheme" class="secondary" title="Motyw">üåô/‚òÄÔ∏è</button>
<button id="fullscreenBtn" class="secondary" title="Pe≈Çny ekran">‚õ∂</button>
<div class="toggle-bar">
<input id="gameId" placeholder="ID gry" value="kalinowe"/>
<button id="joinBtn" class="btn">Do≈ÇƒÖcz</button>
<button id="shareBtn" class="secondary">Udostƒôpnij link</button>
</div>
</header>

<main>
<div id="loading" class="spinner hidden">≈Åadowanie wynik√≥w‚Ä¶</div>

<div class="section-title">Indywidualny leaderboard</div>
<section id="leaderboard" class="leaderboard"></section>

<div class="section-title">Leaderboard par (Best Ball)</div>
<section id="teamboard" class="leaderboard"></section>

<div class="grid">
<table><thead id="thead"></thead><tbody id="tbody"></tbody><tfoot id="tfoot"></tfoot></table>
</div>

<p class="footer">Live Firestore ‚Ä¢ Best Ball ‚Ä¢ Kalinowe Pole</p>
</main>

<script type="module">
// --- dynamiczny offset sticky headera ---
function setStickyOffset(){
const header = document.querySelector('header');
if (!header) return;
const h = header.offsetHeight || 0;
document.documentElement.style.setProperty('--stickyOffset', (h + 12) + 'px');
}
window.addEventListener('load', setStickyOffset);
window.addEventListener('resize', setStickyOffset);
new ResizeObserver(setStickyOffset).observe(document.querySelector('header'));

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase (Tw√≥j projekt)
const app = initializeApp({
apiKey:"AIzaSyDSd57ttRgz_kpaVKurxg7dSXnTSrjQF54",
authDomain:"kalinowe-pola.firebaseapp.com",
projectId:"kalinowe-pola"
});
const db = getFirestore(app);

// Ustawienia
const PLAYERS=["Oliwia","Karolina","Jƒôdrek","Miko≈Çaj","Krystian","Kosma"];
const DEFAULT_TEAMS={
jk:{name:"Jƒôdrek + Kosma",players:["Jƒôdrek","Kosma"],hcp:30},
km:{name:"Krystian + Miko≈Çaj",players:["Krystian","Miko≈Çaj"],hcp:24},
ko:{name:"Karolina + Oliwia",players:["Karolina","Oliwia"],hcp:38}
};
const HOLES=18;
let state={}, gameId="kalinowe";

// UI refs
const thead=document.getElementById("thead"),tbody=document.getElementById("tbody"),tfoot=document.getElementById("tfoot");
const leaderboard=document.getElementById("leaderboard"),teamboard=document.getElementById("teamboard");
const spinner=document.getElementById("loading");
const joinBtn=document.getElementById("joinBtn");
const shareBtn=document.getElementById("shareBtn");

// Theme
document.getElementById("toggleTheme").onclick=()=>{
document.body.classList.toggle("light");
localStorage.setItem("theme",document.body.classList.contains("light")?"light":"dark");
};
if(localStorage.getItem("theme")==="light")document.body.classList.add("light");

// Fullscreen
document.getElementById("fullscreenBtn").onclick=()=>{
if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen();
};

// Share link
shareBtn.onclick=async()=>{
const url=location.origin+location.pathname+"#"+encodeURIComponent(gameId||document.getElementById("gameId").value.trim()||"kalinowe");
try{ await navigator.clipboard.writeText(url); shareBtn.textContent="Skopiowano ‚úÖ"; setTimeout(()=>shareBtn.textContent="Udostƒôpnij link",1200);}catch(e){ alert(url); }
};

// Join
joinBtn.onclick=async()=>{
gameId=(document.getElementById("gameId").value.trim()||"kalinowe");
location.hash="#"+encodeURIComponent(gameId);
spinner.classList.remove("hidden");
const ref=doc(db,"games",gameId);
const snap=await getDoc(ref);
if(!snap.exists()){
const par={},scores={};
for(let h=1;h<=HOLES;h++) par["h"+h]=4;
for(const p of PLAYERS){ scores[p]={}; for(let h=1;h<=HOLES;h++) scores[p]["h"+h]=null; }
await setDoc(ref,{par,scores,teams:DEFAULT_TEAMS,updatedAt:Date.now()});
}
onSnapshot(ref,s=>{ spinner.classList.add("hidden"); state=s.data(); render(); });
};

// Auto-join if hash present
if(location.hash.length>1){ document.getElementById("gameId").value=decodeURIComponent(location.hash.slice(1)); joinBtn.click(); }

function updateField(path,val){
const ref=doc(db,"games",gameId); const payload={}; payload[path]=val; payload.updatedAt=Date.now(); updateDoc(ref,payload);
}

function render(){
const par=state.par||{},scores=state.scores||{};
// Head
thead.innerHTML=""; const thr=document.createElement("tr");
thr.innerHTML=`<th>Do≈Çek</th><th>PAR</th>${PLAYERS.map(p=>`<th>${p}</th>`).join("")}<th>¬± do PAR</th>`;
thead.append(thr);
// Body
tbody.innerHTML="";
for(let h=1;h<=HOLES;h++){
const tr=document.createElement("tr");
const parVal=par["h"+h]??4;
let row=`<td>H${h}</td><td><input class="par" data-hole="${h}" type="number" min="3" max="6" value="${parVal}"></td>`;
for(const p of PLAYERS){
const v=(scores[p]?.["h"+h]??"");
row+=`<td><input class="score" data-player="${p}" data-hole="${h}" type="number" inputmode="numeric" min="1" max="20" value="${v}"></td>`;
}
row+=`<td><span class="badge">${holeDeltas(h,par,scores)}</span></td>`;
tr.innerHTML=row; tbody.append(tr);
}
// Listeners
tbody.querySelectorAll("input.par").forEach(inp=>{
inp.onchange=()=>updateField(`par.h${inp.dataset.hole}`,Number(inp.value)||4);
});
tbody.querySelectorAll("input.score").forEach(inp=>{
inp.onchange=()=>updateField(`scores.${inp.dataset.player}.h${inp.dataset.hole}`,inp.value===""?null:Number(inp.value));
});
// Foot
tfoot.innerHTML=""; const trf=document.createElement("tr");
const parSum=sumPar(par); trf.innerHTML=`<th>SUMA</th><th>${parSum}</th>`;
for(const p of PLAYERS){
const t=playerTotal(p,par,scores);
trf.innerHTML+=`<th><span class="badge ${t.delta<0?"good":t.delta>0?"bad":""}">${t.s??"-"} (${signed(t.delta)})</span></th>`;
}
trf.innerHTML+=`<th>do PAR</th>`; tfoot.append(trf);
// Boards
renderLeaders(par,scores); renderTeams(par,scores);
}

function signed(n){return n>0?`+${n}`:`${n}`;}
function sumPar(par){return Array.from({length:HOLES},(_,i)=>par["h"+(i+1)]??4).reduce((a,b)=>a+Number(b),0);}
function holeDeltas(h,par,scores){
const p=par["h"+h]??4; const parts=[];
for(const name of PLAYERS){ const sc=scores[name]?.["h"+h]; if(sc!=null){ const d=sc-p; parts.push(`${name}:${signed(d)}`); } }
return parts.length?parts.join(" ‚Ä¢ "):"‚Äî";
}
function playerTotal(p,par,scores){
let s=0,d=0,has=false;
for(let h=1;h<=HOLES;h++){ const sc=scores[p]?.["h"+h]; const pa=par["h"+h]??4; if(sc!=null){s+=+sc; d+=(+sc-pa); has=true;} }
return {s:has?s:null, delta:has?d:0};
}
function bestBall(team,par,scores){
let gross=0,has=false; for(let h=1;h<=HOLES;h++){ const a=scores[team.players[0]]?.["h"+h], b=scores[team.players[1]]?.["h"+h];
let best=null; if(a!=null&&b!=null) best=Math.min(+a,+b); else if(a!=null) best=+a; else if(b!=null) best=+b;
if(best!=null){gross+=best; has=true;}
}
const pars=sumPar(par); const net=has?gross-(team.hcp||0):null; const delta=has?gross-pars:0;
return {gross:has?gross:null, net, delta};
}
function renderLeaders(par,scores){
leaderboard.innerHTML="";
const pars=sumPar(par);
const arr=PLAYERS.map(p=>({name:p, ...playerTotal(p,par,scores)})).filter(x=>x.s!=null)
.sort((a,b)=>a.delta-b.delta||a.s-b.s);
arr.forEach((it,i)=>{
const card=document.createElement("div"); card.className="card";
card.innerHTML=`<div class="flex-between"><h3>${i+1}. ${it.name}</h3>
<span class="badge ${it.delta<0?"good":it.delta>0?"bad":""}">${it.s} (${signed(it.delta)})</span></div>
<div class="tiny muted">Par pola: ${pars}</div>`;
leaderboard.append(card);
});
}
function renderTeams(par,scores){
teamboard.innerHTML="";
const teams=(state.teams?state.teams:DEFAULT_TEAMS);
const keys=Object.keys(teams);
const arr=keys.map(k=>({id:k, ...teams[k], ...bestBall(teams[k],par,scores)}))
.sort((a,b)=> (a.net??1e9)-(b.net??1e9));
const pars=sumPar(par);
arr.forEach((it,i)=>{
const card=document.createElement("div"); card.className="card";
const grossStr=it.gross!=null?`${it.gross} (${signed(it.delta)})`:"-";
const netStr=it.net!=null?`${it.net}`:"-";
card.innerHTML=`<div class="flex-between"><h3>${i+1}. ${it.name}</h3>
<div><span class="badge ${it.delta<0?"good":it.delta>0?"bad":""}">GROSS: ${grossStr}</span>
<span class="badge">NET: ${netStr}</span></div></div>
<div class="tiny">HCP: <input type="number" value="${it.hcp||0}" data-team="${it.id}" style="width:64px"></div>
<div class="tiny muted">Par (Best Ball): ${pars}</div>`;
card.querySelector("input[type=number]").onchange=e=>{
const val=Number(e.target.value)||0;
updateField(`teams.${it.id}.hcp`,val);
};
teamboard.append(card);
});
}
</script>
</body>
</html>

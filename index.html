<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Turniej Kalinowe Pole ‚Äì LiveScore (Pary)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
--bg:#0b1020;
--card:rgba(18,25,51,0.92);
--muted:#9bb0d6;
--accent:#9fd25b;
--text:#eef3ff;
--eagle:#8b5cf6;
--birdie:#38bdf8;
--par:#22c55e;
--bogey1:#facc15;
--bogey2:#f97316;
--bogey3:#ef4444;
}

/* üåø T≈ÅO W STYLU POLA GOLFOWEGO */
body{
margin:0;
color:var(--text);
background:
radial-gradient(circle at 70% 20%, rgba(255,255,255,0.08), transparent 40%),
radial-gradient(circle at 20% 80%, rgba(255,255,255,0.06), transparent 45%),
linear-gradient(to bottom right, #0a3d10 0%, #06420c 40%, #072a0a 100%);
background-attachment: fixed;
background-repeat: no-repeat;
min-height:100vh;
font-family:'Inter',sans-serif;
}

.card, .grid, .stats-card, .weather .box{
background:var(--card);
backdrop-filter:blur(6px);
border:1px solid rgba(255,255,255,0.1);
}

/* nag≈Ç√≥wek */
header{
position:sticky;
top:0;
z-index:50;
background:rgba(10,40,15,0.9);
backdrop-filter:blur(10px);
border-bottom:1px solid rgba(255,255,255,0.15);
display:flex;
flex-wrap:wrap;
gap:8px;
align-items:center;
padding:10px;
}

h1{font-size:18px;margin:0 10px 0 0;font-weight:800}
button{cursor:pointer;border:none;border-radius:10px;padding:8px 12px;font-weight:700}
.btn{background:var(--accent);color:#0a0a0a}
.secondary{background:var(--card);color:var(--text);border:1px solid #2a3a72}
input[type=text]{padding:8px 10px;border-radius:10px;border:1px solid #2a3a72;background:#0e1430;color:var(--text)}

.tabs{display:flex;gap:6px;margin-left:10px}
.tab{background:transparent;border:1px solid #2a3a72;color:var(--text)}
.tab.active{background:var(--accent);color:#0a0a0a;border-color:transparent}

main{padding:10px;max-width:1200px;margin:0 auto}
.section-title{margin:14px 4px 6px;font-weight:900;color:var(--accent);font-size:18px}
.grid{border-radius:12px;border:1px solid #2a3a72;overflow:hidden}
table{width:100%;border-collapse:collapse;min-width:760px}
th,td{padding:6px;border-bottom:1px dashed #243468;text-align:center}
th:first-child,td:first-child{text-align:left;padding-left:10px}
input[type=number]{width:70px;text-align:center;padding:6px;border-radius:8px;border:1px solid #2a3a72;background:#0e1430;color:var(--text)}

.score.eagle{background:var(--eagle);color:#fff}
.score.birdie{background:var(--birdie);color:#000}
.score.par{background:var(--par);color:#fff}
.score.bogey1{background:var(--bogey1);color:#000}
.score.bogey2{background:var(--bogey2);color:#fff}
.score.bogey3{background:var(--bogey3);color:#fff}

.leaderboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px}
.card{border:1px solid #2a3a72;border-radius:12px;padding:10px;position:relative}

/* animacja FLIP */
.card.animating{transition:transform .35s ease, opacity .35s ease}
.card.ghost{opacity:.6}

/* TV mode */
.tv .edit-sections{display:none}
.tv .leaderboard{grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}
.tv h3{font-size:28px}
.tv .badge{font-size:20px;padding:6px 10px}
.tv .section-title{font-size:22px}
.tv main{max-width:1400px}

/* drobne elementy */
.flex-between{display:flex;justify-content:space-between;align-items:center;gap:8px}
.badge{padding:3px 7px;border-radius:999px;background:#213169;font-size:13px;display:inline-block}
.good{background:rgba(74,210,115,0.15);border:1px solid #4ad273}
.bad{background:rgba(255,107,107,0.15);border:1px solid #ff6b6b}
.footer{text-align:center;font-size:12px;color:var(--muted);margin-top:10px}

.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:10px;margin-top:15px}
.stats-card{border:1px solid #2a3a72;border-radius:10px;padding:8px 12px}

.weather{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
.weather .box{border-radius:10px;padding:12px}
.weather .big{font-size:32px;font-weight:800}
.weather .muted{color:var(--muted);font-size:13px}

.view{display:none}
.view.active{display:block}

@media(max-width:480px){
input[type=number]{width:60px}
}
</style>
</head>
<body>
<header>
<h1>Turniej Kalinowe Pole ‚Äì LiveScore (Pary)</h1>
<div class="tabs">
<button class="tab active" data-view="scoresView">Wyniki</button>
<button class="tab" data-view="weatherView">Pogoda</button>
<button class="tab" id="tvBtn">Tablica (TV)</button>
</div>
<div style="margin-left:auto;display:flex;gap:6px" class="edit-sections">
<input id="gameId" placeholder="ID gry" value="kalinowe"/>
<button id="joinBtn" class="btn">Do≈ÇƒÖcz</button>
</div>
</header>

<main>
<section id="scoresView" class="view active">
<div class="section-title">Indywidualny leaderboard</div>
<section id="leaderboard" class="leaderboard"></section>

<div class="section-title">Leaderboard par (Best Ball)</div>
<section id="teamboard" class="leaderboard"></section>

<div class="edit-sections">
<div class="section-title">Tabela wynik√≥w</div>
<div class="grid">
<table><thead id="thead"></thead><tbody id="tbody"></tbody><tfoot id="tfoot"></tfoot></table>
</div>

<div class="section-title">Statystyki rundy</div>
<section id="stats" class="stats-grid"></section>
</div>
</section>

<section id="weatherView" class="view">
<div class="section-title">Pogoda ‚Äì Kalinowe Pole</div>
<div id="weather" class="weather">
<div class="box"><div class="big" id="wTemp">--¬∞C</div><div class="muted">Temperatura (odczuwalna: <span id="wApp">--</span>¬∞C)</div></div>
<div class="box"><div class="big" id="wWind">-- m/s</div><div class="muted">Wiatr (<span id="wDir">--</span>)</div></div>
<div class="box"><div class="big" id="wCond">--</div><div class="muted">Warunki</div></div>
<div class="box"><div class="big" id="wTime">--:--</div><div class="muted">Ostatnia aktualizacja</div></div>
</div>
<p class="footer">Aktualizacja co 15 minut (Open-Meteo)</p>
</section>

<p class="footer">Live Firestore ‚Ä¢ Best Ball ‚Ä¢ Kalinowe Pole</p>
</main>

<script type="module">
/* --- Zak≈Çadki + TV --- */
const tabs=document.querySelectorAll('.tab[data-view]');
tabs.forEach(t=>t.addEventListener('click',()=>{
tabs.forEach(x=>x.classList.remove('active'));
t.classList.add('active');
document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
document.getElementById(t.dataset.view).classList.add('active');
}));
document.getElementById('tvBtn').addEventListener('click',()=>{
document.body.classList.toggle('tv');
tabs.forEach(x=>x.classList.remove('active'));
document.querySelector('.tab[data-view="scoresView"]').classList.add('active');
document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
document.getElementById('scoresView').classList.add('active');
});

/* --- Firebase --- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
const app=initializeApp({
apiKey:"AIzaSyDSd57ttRgz_kpaVKurxg7dSXnTSrjQF54",
authDomain:"kalinowe-pola.firebaseapp.com",
projectId:"kalinowe-pola"
});
const db=getFirestore(app);

/* --- konfiguracja gry --- */
const PLAYERS=["Oliwia","Karolina","Jƒôdrek","Miko≈Çaj","Krystian","Kosma"];
const TEAMS={
jk:{name:"Jƒôdrek + Kosma",players:["Jƒôdrek","Kosma"],hcp:30},
km:{name:"Krystian + Miko≈Çaj",players:["Krystian","Miko≈Çaj"],hcp:24},
ko:{name:"Karolina + Oliwia",players:["Karolina","Oliwia"],hcp:38}
};
const HOLES=18; let state={},gameId="kalinowe";
const thead=document.getElementById("thead"),tbody=document.getElementById("tbody"),tfoot=document.getElementById("tfoot"),
leaderboard=document.getElementById("leaderboard"),teamboard=document.getElementById("teamboard"),stats=document.getElementById("stats");

document.getElementById("joinBtn").onclick=async()=>{
gameId=document.getElementById("gameId").value||"kalinowe";
const ref=doc(db,"games",gameId);
const s=await getDoc(ref);
if(!s.exists()){
const par={},scores={};
for(let h=1;h<=HOLES;h++)par["h"+h]=4;
for(const p of PLAYERS){scores[p]={};for(let h=1;h<=HOLES;h++)scores[p]["h"+h]=null;}
await setDoc(ref,{par,scores,teams:TEAMS});
}
onSnapshot(ref,snap=>{state=snap.data();renderAll();});
};

/* --- helpers --- */
function updateField(path,val){const ref=doc(db,"games",gameId);const payload={};payload[path]=val;updateDoc(ref,payload);}
function signed(n){return n>0?`+${n}`:`${n}`;}
function sumPar(par){return Array.from({length:HOLES},(_,i)=>par["h"+(i+1)]??4).reduce((a,b)=>a+Number(b),0);}
function playerTotal(p,par,s){let sc=0,d=0,h=false;for(let i=1;i<=HOLES;i++){const v=s[p]?.["h"+i],pa=par["h"+i]??4;if(v!=null){sc+=+v;d+=(+v-pa);h=true;}}return{s:h?sc:null,delta:h?d:0};}
function bestBall(t,par,s){let g=0,h=false;for(let i=1;i<=HOLES;i++){const a=s[t.players[0]]?.["h"+i],b=s[t.players[1]]?.["h"+i];let best=null;if(a!=null&&b!=null)best=Math.min(+a,+b);else if(a!=null)best=+a;else if(b!=null)best=+b;if(best!=null){g+=best;h=true;}}const pars=sumPar(par),net=h?g-(t.hcp||0):null,delta=h?g-pars:0;return{gross:h?g:null,net,delta};}
function colorClass(d){if(d<=-2)return"eagle";if(d==-1)return"birdie";if(d==0)return"par";if(d==1)return"bogey1";if(d==2)return"bogey2";if(d>=3)return"bogey3";return"";}

/* --- tabela --- */
function renderTable(par,scores){
thead.innerHTML=`<tr><th>Do≈Çek</th><th>PAR</th>${PLAYERS.map(p=>`<th>${p}</th>`).join("")}<th>¬± do PAR</th></tr>`;
tbody.innerHTML="";
for(let h=1;h<=HOLES;h++){
const parVal=par["h"+h]??4;
let row=`<td>H${h}</td><td><input class="par" data-hole="${h}" type="number" value="${parVal}"></td>`;
for(const p of PLAYERS){
const v=scores[p]?.["h"+h];const diff=v!=null?v-parVal:null;const cls=colorClass(diff);
row+=`<td><input class="score ${cls}" data-player="${p}" data-hole="${h}" type="number" value="${v??""}"></td>`;
}
const txt=PLAYERS.map(n=>{const sc=scores[n]?.["h"+h];if(sc==null)return null;const d=sc-(par["h"+h]??4);return`${n}:${signed(d)}`;}).filter(Boolean).join(" ‚Ä¢ ");
tbody.insertAdjacentHTML("beforeend",`<tr>${row}<td><span class="badge">${txt||"‚Äî"}</span></td></tr>`);
}
const pars=sumPar(par);
tfoot.innerHTML=`<tr><th>SUMA</th><th>${pars}</th>`+PLAYERS.map(p=>{const t=playerTotal(p,par,scores);return`<th><span class="badge ${t.delta<0?"good":t.delta>0?"bad":""}">${t.s??"-"} (${signed(t.delta)})</span></th>`;}).join("")+`<th></th>`;
tbody.querySelectorAll("input.par").forEach(i=>i.onchange=()=>updateField(`par.h${i.dataset.hole}`,+i.value));
tbody.querySelectorAll("input.score").forEach(i=>i.onchange=()=>updateField(`scores.${i.dataset.player}.h${i.dataset.hole}`,i.value===""?null:+i.value));
}

/* --- FLIP animation --- */
function flipAnimate(cont,newNodes){
const first=new Map();Array.from(cont.children).forEach(e=>first.set(e.dataset.key,e.getBoundingClientRect().top));
newNodes.forEach(n=>cont.appendChild(n));
Array.from(cont.children).forEach(e=>{const key=e.dataset.key;const last=e.getBoundingClientRect().top;const delta=first.has(key)?first.get(key)-last:0;if(Math.abs(delta)>0.5){e.classList.add("animating","ghost");e.style.transform=`translateY(${delta}px)`;requestAnimationFrame(()=>{e.style.transform="translateY(0)";e.addEventListener("transitionend",()=>{e.classList.remove("animating","ghost");e.style.transform="";},{once:true});});}});}
function renderLeaders(par,s){const pars=sumPar(par);const data=PLAYERS.map(p=>({name:p,...playerTotal(p,par,s)})).filter(x=>x.s!=null).sort((a,b)=>a.delta-b.delta||a.s-b.s);
const nodes=data.map((it,i)=>{let c=leaderboard.querySelector(`[data-key="${it.name}"]`);if(!c){c=document.createElement("div");c.className="card";c.dataset.key=it.name;}
c.innerHTML=`<div class="flex-between"><h3>${i+1}. ${it.name}</h3><span class="badge ${it.delta<0?"good":it.delta>0?"bad":""}">${it.s} (${signed(it.delta)})</span></div><div class="tiny muted">Par pola: ${pars}</div>`;return c;});flipAnimate(leaderboard,nodes);}
function renderTeams(par,s){const pars=sumPar(par);const items=Object.entries(TEAMS).map(([id,t])=>({id,...t,...bestBall(t,par,s)})).sort((a,b)=>(a.net??1e9)-(b.net??1e9));
const nodes=
